/*
Copyright (c) 2022 Rune AI Inc.
All rights reserved.

This code is proprietary to Rune AI Inc.
The code may be used solely for accessing the Service provided by Rune AI Inc. following the Rune Terms of Service ("Terms") accessible at rune.ai/eula. You may not use this code for any use or purpose other than as expressly permitted by the Terms.
Restrictions set forth in the Terms include, but is not limited to, that you may not copy, adapt, modify, prepare derivative works based upon, distribute, license, sell, transfer, publicly display, publicly perform, transmit, stream, broadcast, attempt to discover any source code, reverse engineer, decompile, dissemble, or otherwise exploit the code as a whole or any portion of the code.
*/
"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!e)throw t instanceof Error?t:new Error(null!=t?t:"Assertion failed")}var r,i,o;function n(e,t,r){var i=Math.floor(r/4294967296),o=r;e.setUint32(t,i),e.setUint32(t+4,o)}var s=("undefined"==typeof process||"never"!==(null===(r=null===process||void 0===process?void 0:process.env)||void 0===r?void 0:r.TEXT_ENCODING))&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function a(e){for(var t=e.length,r=0,i=0;i<t;){var o=e.charCodeAt(i++);if(0!=(4294967168&o))if(0==(4294965248&o))r+=2;else{if(o>=55296&&o<=56319&&i<t){var n=e.charCodeAt(i);56320==(64512&n)&&(++i,o=((1023&o)<<10)+(1023&n)+65536)}r+=0==(4294901760&o)?3:4}else r++}return r}var f=s?new TextEncoder:void 0,c=s?"undefined"!=typeof process&&"force"!==(null===(i=null===process||void 0===process?void 0:process.env)||void 0===i?void 0:i.TEXT_ENCODING)?200:0:4294967295;var u=(null==f?void 0:f.encodeInto)?function(e,t,r){f.encodeInto(e,t.subarray(r))}:function(e,t,r){t.set(f.encode(e),r)};s&&new TextDecoder,!s||"undefined"!=typeof process&&(null===(o=null===process||void 0===process?void 0:process.env)||void 0===o||o.TEXT_DECODER);var h,l=function(e,t){this.type=e,this.data=t},p=(h=function(e,t){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},h(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),d=function(e){function t(r){var i=e.call(this,r)||this,o=Object.create(t.prototype);return Object.setPrototypeOf(i,o),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:t.name}),i}return p(t,e),t}(Error);var y={type:-1,encode:function(e){var t,r,i,o;return e instanceof Date?function(e){var t,r=e.sec,i=e.nsec;if(r>=0&&i>=0&&r<=17179869183){if(0===i&&r<=4294967295){var o=new Uint8Array(4);return(t=new DataView(o.buffer)).setUint32(0,r),o}var s=r/4294967296,a=4294967295&r;return o=new Uint8Array(8),(t=new DataView(o.buffer)).setUint32(0,i<<2|3&s),t.setUint32(4,a),o}return o=new Uint8Array(12),(t=new DataView(o.buffer)).setUint32(0,i),n(t,4,r),o}((t=e.getTime(),r=Math.floor(t/1e3),i=1e6*(t-1e3*r),o=Math.floor(i/1e9),{sec:r+o,nsec:i-1e9*o})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:i=t.getUint32(0),nsec:0};case 8:var r=t.getUint32(0);return{sec:i=4294967296*(3&r)+t.getUint32(4),nsec:r>>>2};case 12:var i=function(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}(t,4);return{sec:i,nsec:t.getUint32(0)};default:throw new d("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},w=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(y)}return e.prototype.register=function(e){var t=e.type,r=e.encode,i=e.decode;if(t>=0)this.encoders[t]=r,this.decoders[t]=i;else{var o=1+t;this.builtInEncoders[o]=r,this.builtInDecoders[o]=i}},e.prototype.tryToEncode=function(e,t){for(var r=0;r<this.builtInEncoders.length;r++){if(null!=(i=this.builtInEncoders[r]))if(null!=(o=i(e,t)))return new l(-1-r,o)}for(r=0;r<this.encoders.length;r++){var i,o;if(null!=(i=this.encoders[r]))if(null!=(o=i(e,t)))return new l(r,o)}return e instanceof l?e:null},e.prototype.decode=function(e,t,r){var i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,r):new l(t,e)},e.defaultCodec=new e,e}();var v=function(){function t(e,t,r,i,o,n,s,a){void 0===e&&(e=w.defaultCodec),void 0===t&&(t=void 0),void 0===r&&(r=100),void 0===i&&(i=2048),void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),this.extensionCodec=e,this.context=t,this.maxDepth=r,this.initialBufferSize=i,this.sortKeys=o,this.forceFloat32=n,this.ignoreUndefined=s,this.forceIntegerToFloat=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},t.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},t.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));null===e?this.encodeNil():void 0===e?this.encodeUndefined():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},t.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},t.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t),i=new DataView(t);r.set(this.bytes),this.view=i,this.bytes=r},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeUndefined=function(){this.writeU8(193)},t.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},t.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too long string: ".concat(e," bytes in UTF-8"));this.writeU8(219),this.writeU32(e)}},t.prototype.encodeString=function(e){if(e.length>c){var t=a(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),u(e,this.bytes,this.pos),this.pos+=t}else{t=a(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,r){for(var i=e.length,o=r,n=0;n<i;){var s=e.charCodeAt(n++);if(0!=(4294967168&s)){if(0==(4294965248&s))t[o++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&n<i){var a=e.charCodeAt(n);56320==(64512&a)&&(++n,s=((1023&s)<<10)+(1023&a)+65536)}0==(4294901760&s)?(t[o++]=s>>12&15|224,t[o++]=s>>6&63|128):(t[o++]=s>>18&7|240,t[o++]=s>>12&63|128,t[o++]=s>>6&63|128)}t[o++]=63&s|128}else t[o++]=s}}(e,this.bytes,this.pos),this.pos+=t}},t.prototype.encodeObject=function(t,r){var i=this.extensionCodec.tryToEncode(t,this.context);if(null!=i)this.encodeExtension(i);else if(Array.isArray(t))this.encodeArray(t,r);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else{if("object"!==e(t))throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(t)));this.encodeMap(t,r)}},t.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large binary: ".concat(t));this.writeU8(198),this.writeU32(t)}var r,i=(r=e)instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r);this.writeU8a(i)},t.prototype.encodeArray=function(e,t){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large array: ".concat(r));this.writeU8(221),this.writeU32(r)}for(var i=0,o=e;i<o.length;i++){var n=o[i];this.doEncode(n,t+1)}},t.prototype.countWithoutUndefined=function(e,t){for(var r=0,i=0,o=t;i<o.length;i++){void 0!==e[o[i]]&&r++}return r},t.prototype.encodeMap=function(e,t){var r=Object.keys(e);this.sortKeys&&r.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else{if(!(i<4294967296))throw new Error("Too large map object: ".concat(i));this.writeU8(223),this.writeU32(i)}for(var o=0,n=r;o<n.length;o++){var s=n[o],a=e[s];this.ignoreUndefined&&void 0===a||(this.encodeString(s),this.doEncode(a,t+1))}},t.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too large extension object: ".concat(t));this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)},t.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},t.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},t.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},t.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},t.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},t.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},t.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},t.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},t.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},t.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),function(e,t,r){var i=r/4294967296,o=r;e.setUint32(t,i),e.setUint32(t+4,o)}(this.view,this.pos,e),this.pos+=8},t.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),n(this.view,this.pos,e),this.pos+=8},t}(),b={};var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},U={exports:{}};function m(e,t){var r,i;return void 0===t&&(t={}),S(function(e,t){return void 0===t&&(t=b),new v(t.extensionCodec,t.context,t.maxDepth,t.initialBufferSize,t.sortKeys,t.forceFloat32,t.ignoreUndefined,t.forceIntegerToFloat).encodeSharedRef(e)}(e,{maxDepth:null!==(r=t.maxDepth)&&void 0!==r?r:10,sortKeys:null===(i=t.sortKeys)||void 0===i||i}))}!function(t,r){!function(i){var o=r,n=t&&t.exports==o&&t,s="object"==e(g)&&g;s.global!==s&&s.window!==s||(i=s);var a=function(e){this.message=e};(a.prototype=new Error).name="InvalidCharacterError";var f=function(e){throw new a(e)},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,h={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&f("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,i,o,n=e.length%3,s="",a=-1,u=e.length-n;++a<u;)t=e.charCodeAt(a)<<16,r=e.charCodeAt(++a)<<8,i=e.charCodeAt(++a),s+=c.charAt((o=t+r+i)>>18&63)+c.charAt(o>>12&63)+c.charAt(o>>6&63)+c.charAt(63&o);return 2==n?(t=e.charCodeAt(a)<<8,r=e.charCodeAt(++a),s+=c.charAt((o=t+r)>>10)+c.charAt(o>>4&63)+c.charAt(o<<2&63)+"="):1==n&&(o=e.charCodeAt(a),s+=c.charAt(o>>2)+c.charAt(o<<4&63)+"=="),s},decode:function(e){var t=(e=String(e).replace(u,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&f("Invalid character: the string to be decoded is not correctly encoded.");for(var r,i,o=0,n="",s=-1;++s<t;)i=c.indexOf(e.charAt(s)),r=o%4?64*r+i:i,o++%4&&(n+=String.fromCharCode(255&r>>(-2*o&6)));return n},version:"1.0.0"};if(o&&!o.nodeType)if(n)n.exports=h;else for(var l in h)h.hasOwnProperty(l)&&(o[l]=h[l]);else i.base64=h}(g)}(U,U.exports);var S=function(e){for(var t=[],r=0,i=e.length;r<i;r++)t.push(String.fromCharCode(e[r]));return U.exports.encode(t.join(""))};function T(e){t(null!==e&&"object"==typeof e);return{gameState:e,stringifiedGameState:m(e,{sortKeys:!0})}}function O(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}function A(e,r){var i,o;if(void 0!==e){t("object"==typeof e&&null!==e&&O(e),"must be an object"),t("players"in e,"must have players property"),t("object"==typeof e.players&&null!==e.players&&O(e.players),"players must be an object"),t(Object.keys(e.players).length>0,"players must not be empty"),t(Object.keys(e.players).sort().toString()===r.sort().toString(),"all game players must be mentioned in the players object");var n=Object.values(e.players);try{for(var s=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),a=s.next();!a.done;a=s.next()){var f=a.value;t("number"==typeof f&&!isNaN(f)&&Number.isInteger(f)&&f>=0||["WON","LOST"].includes(f),"only positive integers (scores), WON, or LOST are allowed as player results")}}catch(e){i={error:e}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t(n.every((function(e){return["WON","LOST"].includes(e)}))||n.every((function(e){return"number"==typeof e})),"all players must have either WON or LOST or all players must have a score"),"delayPopup"in e&&t("boolean"==typeof e.delayPopup,"delayPopup must be a boolean")}}function j(e){if(null===e)return e;t("object"==typeof e),t("reason"in e);var r=e.reason;return t("gameEnded"===r||"playerLeft"===r||"minPlayers"===r||"err"===r),t("players"in e),t("object"==typeof e.players&&null!==e.players),"options"in e&&A(e.options,Object.keys(e.players)),{reason:r,players:e.players,options:"options"in e&&e.options?e.options:void 0}}function E(e){t(null!==e&&"object"==typeof e),t("gameOver"in e),t("orderNumber"in e),t("sessionId"in e),t("gameId"in e);var r=e.gameOver,i=e.orderNumber,o=e.sessionId,n=e.gameId;return t("number"==typeof i),t("string"==typeof o),t("number"==typeof n),{gameOver:j(r),orderNumber:i,sessionId:o,gameId:n}}function I(e){t(null!==e&&"object"==typeof e),t("seed"in e),t("actionCount"in e);var r=e.seed,i=e.actionCount;return t("number"==typeof r),t("number"==typeof i),{seed:r,actionCount:i}}function x(e){t(null!==e&&"object"==typeof e);var r=Object.entries(e).map((function(e){var t=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,o,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}(e,2);return[t[0],I(t[1])]}));return Object.fromEntries(r)}exports.validateServerSerializationData=function(e){t(null!==e&&"object"==typeof e),t("game"in e),t("context"in e),t("random"in e),t("gameTime"in e);var r=e.game,i=e.context,o=e.random,n=e.gameTime,s="updateCount"in e?e.updateCount:0;return t("number"==typeof n&&n>=0),t("number"==typeof s&&s>=0),{game:T(r).gameState,context:E(i),random:x(o),gameTime:n,updateCount:s}};
